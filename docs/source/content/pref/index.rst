***************
Preferans
***************

"Карта" здесь и ниже - это текстовая строка-идентификатор игральной карты (2 или 3 символа). Имеет формат МАСТЬЗНАЧЕНИЕ (для примера: H6, SJ, C10, DA).
Первый символ - это масть::

"S" - Spades - пики (вини)
"C" - Clubs - трефы (крести)
"H" - Hearts - червы
"D" - Diamonds - бубны (буби)

Остальные символы - значение::

"7";
"8";
"9";
"10";
"J" - Jack - валет;
"Q" - Queen - королева;
"K" - King - король;
"A" - Ace - туз

Старт игры
====================================

В преферансе участвует 3 игрока.

После старта игры, кроме основного сообщения от сервера (о нём ниже), так же прилетит событие "game.player.start" (каждому игроку - своё сообщение), внутри - сортированный список карт на руке:

.. literalinclude:: code/game_start.json

Ход игрока
====================================

**Варианты хода**

Сделать пас.
------------------------------------

Работает как для выбора контракта, так и при выборе виста

.. literalinclude:: code/move/pass.json

Сделать ставку.
------------------------------------

.. literalinclude:: code/move/bet.json

Мизер.
------------------------------------

.. literalinclude:: code/move/misere.json

Мизер без прикупа.
------------------------------------

.. literalinclude:: code/move/misere_wt.json

Вист.
------------------------------------

.. literalinclude:: code/move/whist.json

Полувист.
------------------------------------

.. literalinclude:: code/move/whist_half.json

Выбор типа виста.
------------------------------------

.. literalinclude:: code/move/whist_type.json

Скинуть две карты.
------------------------------------

.. literalinclude:: code/move/drop.json

Без трёх.
------------------------------------

.. literalinclude:: code/move/without_three.json

Кинуть карту.
------------------------------------

.. literalinclude:: code/move/throw.json

**Структура ответа**

Ответ от сервера после хода практически аналогичен ответу при старте (при старте нет "data.move.prev")

Ответ сервера
------------------------------------

.. literalinclude:: code/answer.json

Здесь и ниже "первый/второй/третий" игрок - это не фактическое место за столом, а условно-принятый порядковый номер для позиционирования в игре. Не меняется во время партии! 

Стадии игры
------------------------------------

* "betting" - стадия торговли
* "drop" - сброс двух карт
* "contract" - выбор контракта (завистовавшим игроком)
* "whist" - выбор виста
* "game" - игра (когда разыгрывают взятки)

Объект игрока
------------------------------------

.. literalinclude:: code/player.json

Контракты игрока
------------------------------------

Ставка:

.. literalinclude:: code/contract/bet.json

Мизер:

.. literalinclude:: code/contract/misere.json

Мизер без прикупа:

.. literalinclude:: code/contract/misere_wt.json

Пасс:

.. literalinclude:: code/contract/pass.json

Вист:

.. literalinclude:: code/contract/whist.json

Полвиста:

.. literalinclude:: code/contract/whist_half.json

Взятка
------------------------------------

.. literalinclude:: code/trick.json

Структура одинакова как в сущности игрока ("players.*.tricks"), так и на столе ("board.trick")

Зона игрока в пульке
------------------------------------

.. literalinclude:: code/score_sheet.json

Здесь в каждом массиве приходит упорядоченный список "#int#" всех прошлых результатов (например: [1,3,9,11,15])

**Структура ответа о "предыдущем ходе**

(data.move.prev)

Сделал пас
------------------------------------

.. literalinclude:: code/move_prev/pass.json

Сделал ставку
------------------------------------

.. literalinclude:: code/move_prev/bet.json

Мизер
------------------------------------

.. literalinclude:: code/move_prev/misere.json

Мизер без прикупа
------------------------------------

.. literalinclude:: code/move_prev/misere_wt.json

Вист
------------------------------------

.. literalinclude:: code/move_prev/whist.json

Полувист
------------------------------------

.. literalinclude:: code/move_prev/whist_half.json

Выбрал тип виста
------------------------------------

.. literalinclude:: code/move_prev/whist_type.json

Скинул две карты
------------------------------------

.. literalinclude:: code/move_prev/drop.json

Выбрал "без трёх"
------------------------------------

.. literalinclude:: code/move_prev/without_three.json

Кинул карту
------------------------------------

.. literalinclude:: code/move_prev/throw.json

В конце каждого хода игрока, прилетит событие "game.player.move", внутри - список карт на руке (структура аналогична "game.player.start").

**Структура ответа о "следующем ходе"**

(data.move.next.choice)

Сервер присылает возможные варианты хода следующего игрока.

Может сделать пас
------------------------------------

.. literalinclude:: code/move_next/pass.json

Может сделать ставку
------------------------------------

.. literalinclude:: code/move_next/bet.json

Мизер
------------------------------------

.. literalinclude:: code/move_next/misere.json

Мизер без прикупа
------------------------------------

.. literalinclude:: code/move_prev/misere_wt.json

Вист
------------------------------------

.. literalinclude:: code/move_next/whist.json

Полувист
------------------------------------

.. literalinclude:: code/move_next/whist_half.json

Выбрать тип виста
------------------------------------

.. literalinclude:: code/move_next/whist_type.json

Скинуть две карты
------------------------------------

.. literalinclude:: code/move_next/drop.json

Выбрать "без трёх"
------------------------------------

.. literalinclude:: code/move_next/without_three.json

Кинуть карту
------------------------------------

.. literalinclude:: code/move_next/throw.json

**Игрок заявляет о своей победе**

Во время игры игрок может предложить другим игрокам закончить раздачу и согласиться с тем, что он выиграл N-взяток.

TODO: скорее всего, всем прилетит событие "game.dispatch" с картами данного игрока

Конец игры
====================================

Сразу после последнего хода прилетит событие "game.finish" о завершении игры с результатами.

.. literalinclude:: code/game_end.json

Игрок покидает игру
====================================

Если игрок выходит из игры (сам или его выкинет сервер), то его заменяет "бот" - теперь все ходы за него будет делать сам сервер.

Если из игры выйдет сразу два игрока, то игра завершится.